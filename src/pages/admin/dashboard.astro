---
// src/pages/admin/dashboard.astro
import Nav from "../../components/utils/Nav.astro"; // Ruta corregida
import "/src/styles/global.css";

// 1. Preparamos la configuración de Firebase para pasarla al cliente
const clientSideFirebaseConfig = {
    apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY,
    authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN,
    projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID,
    appId: import.meta.env.PUBLIC_FIREBASE_APP_ID,
};
---

<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dashboard Admin</title>
    </head>
    <body>
        <Nav currentPage="dashboard" />

        <section class="p-4 md:p-8">
            <h1 class="text-3xl font-bold mb-8">
                Bienvenido al Dashboard de Administración
            </h1>

            <div
                class="grid border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 md:grid-cols-2 bg-white dark:bg-gray-800"
            >
                <figure
                    class="flex flex-col items-center justify-center p-8 text-center bg-white border-b border-gray-200 rounded-t-lg md:rounded-t-none md:rounded-ss-lg md:border-e dark:bg-gray-800 dark:border-gray-700"
                >
                    <blockquote
                        class="max-w-2xl mx-auto mb-4 text-gray-500 lg:mb-8 dark:text-gray-400"
                    >
                        <h3
                            class="text-lg font-semibold text-gray-900 dark:text-white"
                        >
                            Publicaciones
                        </h3>
                        <p class="my-4">
                            Gestiona las entradas del blog de Get Your Depa.
                        </p>
                        <a
                            href="/admin/posts"
                            class="text-blue-600 hover:underline"
                            >Ir a Publicaciones →</a
                        >
                    </blockquote>
                </figure>

                <figure
                    class="flex flex-col items-center justify-center p-8 text-center bg-white border-b border-gray-200 md:rounded-se-lg dark:bg-gray-800 dark:border-gray-700"
                >
                    <blockquote
                        class="max-w-2xl mx-auto mb-4 text-gray-500 lg:mb-8 dark:text-gray-400"
                    >
                        <h3
                            class="text-lg font-semibold text-gray-900 dark:text-white"
                        >
                            Zonas
                        </h3>
                        <p class="my-4">
                            Administra las zonas que se muestran en el sitio.
                        </p>
                        <a
                            href="/admin/zones"
                            class="text-blue-600 hover:underline"
                            >Ir a Zonas →</a
                        >
                    </blockquote>
                </figure>

                <figure
                    class="flex flex-col items-center justify-center p-8 text-center bg-white border-b border-gray-200 md:rounded-es-lg md:border-b-0 md:border-e dark:bg-gray-800 dark:border-gray-700"
                >
                    <blockquote
                        class="max-w-2xl mx-auto mb-4 text-gray-500 lg:mb-8 dark:text-gray-400"
                    >
                        <h3
                            class="text-lg font-semibold text-gray-900 dark:text-white"
                        >
                            Departamentos
                        </h3>
                        <p class="my-4">
                            Gestiona los listados de departamentos.
                        </p>
                        <a
                            href="/admin/listings"
                            class="text-blue-600 hover:underline"
                            >Ir a Departamentos →</a
                        >
                    </blockquote>
                </figure>
            </div>
        </section>

        <script
            type="module"
            define:vars={{ firebaseConfig: clientSideFirebaseConfig }}
        >
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
            import {
                getAuth,
                onAuthStateChanged,
                signOut,
            } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

            // Inicializamos Firebase con la config que viene del servidor
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            // Verificamos si el usuario tiene sesión activa para proteger la ruta
            onAuthStateChanged(auth, (user) => {
                if (!user) {
                    // Si no hay sesión, lo redirigimos a la página de login
                    window.location.href = "/admin/login";
                }
            });

            // La lógica del botón de logout usualmente está en el componente Nav,
            // pero si está aquí, nos aseguramos de que no de error si no encuentra el botón.
            const logoutButton = document.getElementById("logout-btn");
            if (logoutButton) {
                logoutButton.addEventListener("click", async () => {
                    try {
                        await signOut(auth);
                        window.location.href = "/admin/login";
                    } catch (error) {
                        console.error("Error al cerrar sesión:", error);
                        alert("Error al cerrar sesión.");
                    }
                });
            }
        </script>
    </body>
</html>
