---
// src/components/utils/Nav.astro

// 1. Preparamos la configuración de Firebase para el script del componente
const firebaseConfig = {
  apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY,
  authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID,
  appId: import.meta.env.PUBLIC_FIREBASE_APP_ID,
};

// Recibimos la página actual para poder resaltar el enlace activo
const { currentPage } = Astro.props;
---

<nav class="bg-gray-800 text-white p-4 flex justify-between items-center">
  <div class="flex items-center space-x-8">
    <a href="/admin/dashboard" class="text-xl font-bold">GYD - CMS</a>
    <ul class="flex space-x-4">
      <li>
        <a
          href="/admin/dashboard"
          class:list={{ "font-bold underline": currentPage === "dashboard" }}
          >Dashboard</a>
      </li>
      <li>
        <a
          href="/admin/posts"
          class:list={{ "font-bold underline": currentPage === "posts" }}
          >Posts</a>
      </li>
      <li>
        <a
          href="/admin/zones"
          class:list={{ "font-bold underline": currentPage === "zones" }}
          >Zonas</a>
      </li>
      <li>
        <a
          href="/admin/listings"
          class:list={{ "font-bold underline": currentPage === "listings" }}
          >Departamentos</a>
      </li>
      <li>
        <a
          href="/admin/gallery"
          class:list={{ "font-bold underline": currentPage === "gallery" }}
          >Galería</a>
      </li>
    </ul>
  </div>
  <button
    id="logout-btn"
    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
  >
    Cerrar sesión
  </button>
</nav>

<script type="module" define:vars={{ firebaseConfig }}>
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    signOut,
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const logoutButton = document.getElementById("logout-btn");

  if (logoutButton) {
    logoutButton.addEventListener("click", () => {
      signOut(auth)
        .then(() => {
          // Logout exitoso, redirigir al login
          window.location.href = "/admin/login";
        })
        .catch((error) => {
          console.error("Error al cerrar sesión:", error);
          alert("Hubo un error al cerrar la sesión.");
        });
    });
  }
</script>
